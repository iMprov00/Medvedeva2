<!-- Заголовок страницы -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-3">Контакты</h1>
                <p class="lead text-muted mb-0">Мы всегда рады помочь вам и ответить на ваши вопросы</p>
            </div>
        </div>
    </div>
</section>

<!-- Контактная информация -->
<section class="py-5">
    <div class="container">
        <div class="row g-5">
            <!-- Информация о клинике -->
            <div class="col-lg-6">
                <div class="mb-5">
                    <h2 class="display-6 fw-bold mb-4">Остались вопросы? Мы вам поможем</h2>
                    <p class="text-muted mb-4">
                        Запишитесь на прием, уточните информацию о лечении или задайте любой вопрос о здоровье вашего ребенка. 
                        Мы ответим оперативно и подробно.
                    </p>
                </div>
                
                <!-- Контактные блоки -->
                <div class="row g-4">
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-start gap-3 mb-3">
                                    <div class="icon-wrapper icon-wrapper-primary flex-shrink-0">
                                        <i class="bi bi-geo-alt fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold mb-2">Адрес</h5>
                                        <p class="text-muted mb-0">
                                            г. Барнаул, ул. 280-летия Барнаула, д. 22<br>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-start gap-3 mb-3">
                                    <div class="icon-wrapper icon-wrapper-secondary flex-shrink-0">
                                        <i class="bi bi-telephone fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold mb-2">Телефоны</h5>
                                        <p class="text-muted mb-0">
                                            <a href="tel:+79133650464" class="text-decoration-none text-dark">+7 (913) 365-04-64</a><br>   
                                            <a href="tel:+73852256575" class="text-decoration-none text-dark">+7 (385) 225-65-75</a><br>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-start gap-3 mb-3">
                                    <div class="icon-wrapper icon-wrapper-primary flex-shrink-0">
                                        <i class="bi bi-envelope fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold mb-2">Электронная почта</h5>
                                        <p class="text-muted mb-0">
                                            <a href="mailto:info@medvedeva-clinic.ru" class="text-decoration-none text-dark">info@medvedeva-clinic.ru</a>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="col-md-6">
                        <div class="card border-0 shadow-sm h-100">
                            <div class="card-body p-4">
                                <div class="d-flex align-items-start gap-3 mb-3">
                                    <div class="icon-wrapper icon-wrapper-secondary flex-shrink-0">
                                        <i class="bi bi-clock fs-4"></i>
                                    </div>
                                    <div>
                                        <h5 class="fw-bold mb-2">Часы работы</h5>
                                        <div class="text-muted">
                                            <div class="d-flex justify-content-between mb-1">
                                                <span>Пн-Пт</span>
                                                <span class="fw-semibold">09:00 - 19:00</span>
                                            </div>
                                            <div class="d-flex justify-content-between mb-1">
                                                <span>Суббота</span>
                                                <span class="fw-semibold">09:15 - 15:00</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                

            </div>
            
            <!-- Форма обратной связи -->
<!-- Форма обратной связи -->
            <div class="col-lg-6">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body p-4">
                        <h3 class="h4 mb-4">Напишите нам прямо сейчас</h3>
                        <p class="text-muted mb-4">Заполните форму и мы свяжемся с вами в ближайшее время</p>
                        
                        <form id="contactForm">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <label for="name" class="form-label">Ваше имя *</label>
                                    <input type="text" class="form-control" id="name" name="name" required>
                                </div>
                                
                                <div class="col-md-6">
                                    <label for="phone" class="form-label">Телефон *</label>
                                    <input type="tel" class="form-control" id="phone" name="phone" required>
                                </div>
                                
                                <div class="col-12">
                                    <label for="email" class="form-label">Email *</label>
                                    <input type="email" class="form-control" id="email" name="email" required>
                                </div>
                                
                                <div class="col-12">
                                    <label for="subject" class="form-label">Тема *</label>
                                    <select class="form-select" id="subject" name="subject" required>
                                        <option value="">Выберите тему</option>
                                        <option value="Консультация">Консультация</option>
                                        <option value="Запись на прием">Запись на прием</option>
                                        <option value="Вопрос по услугам">Вопрос по услугам</option>
                                        <option value="Отзыв">Отзыв</option>
                                        <option value="Другое">Другое</option>
                                    </select>
                                </div>
                                
                                <div class="col-12">
                                    <label for="message" class="form-label">Сообщение *</label>
                                    <textarea class="form-control" id="message" name="message" rows="4" required></textarea>
                                </div>
                                
                                <div class="col-12">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="privacyContact" name="privacy_accepted" required>
                                        <label class="form-check-label" for="privacyContact">
                                            Я соглашаюсь с <a href="/privacy" target="_blank">политикой конфиденциальности</a> *
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="col-12">
                                    <button type="submit" class="btn btn-primary w-100">
                                        <i class="bi bi-send me-2"></i>Отправить сообщение
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Карта -->
<section class="py-5 bg-light">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <h2 class="display-6 fw-bold mb-4 text-center">Как добраться</h2>
                
                <div class="card border-0 shadow-sm">
                    <div class="card-body p-0">
                        <!-- Карта -->
                        <div class="position-relative">
                            <div id="map" class="rounded-top" style="height: 400px; width: 100%;">
                            <script type="text/javascript" charset="utf-8" async src="https://api-maps.yandex.ru/services/constructor/1.0/js/?um=constructor%3A3271854cc32f28ece92a708a0d6ed2a5aca19c4f85608b8da95dd56852b00d28&width=100%&height=400&lang=ru_RU&scroll=true"></script></div>
                        </div>
                        
                        <!-- Инструкции -->
<%#                         <div class="p-4">
                            <div class="row g-3">
                                <div class="col-md-6">
                                    <h5 class="fw-bold mb-3">Общественный транспорт</h5>
                                    <div class="d-flex align-items-start gap-2 mb-2">
                                        <i class="bi bi-subway text-primary mt-1"></i>
                                        <div>
                                            <div class="fw-semibold">Метро "Примерная"</div>
                                            <small class="text-muted">5 минут пешком от выхода из метро</small>
                                        </div>
                                    </div>
                                    <div class="d-flex align-items-start gap-2">
                                        <i class="bi bi-bus-front text-primary mt-1"></i>
                                        <div>
                                            <div class="fw-semibold">Автобусы: 123, 456</div>
                                            <small class="text-muted">Остановка "Клиническая"</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <h5 class="fw-bold mb-3">Парковка</h5>
                                    <ul class="list-unstyled text-muted">
                                        <li class="mb-1">✓ Бесплатная парковка во дворе</li>
                                        <li class="mb-1">✓ 15 машиномест для пациентов</li>
                                        <li>✓ Крытая охраняемая парковка</li>
                                    </ul>
                                </div>
                            </div>
                        </div> %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Переменная для предотвращения двойной отправки
    let isSubmittingContactForm = false;
    
    // Обработка формы контактов
    const contactForm = document.getElementById('contactForm');
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Защита от двойной отправки
            if (isSubmittingContactForm) return;
            isSubmittingContactForm = true;
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.textContent;
            
            submitBtn.textContent = 'Отправка...';
            submitBtn.disabled = true;
            
            // Валидация формы
            if (!this.checkValidity()) {
                this.classList.add('was-validated');
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                isSubmittingContactForm = false;
                return;
            }
            
            // Проверяем согласие с политикой конфиденциальности
            const privacyCheckbox = document.getElementById('privacyContact');
            if (!privacyCheckbox || !privacyCheckbox.checked) {
                alert('Пожалуйста, подтвердите согласие с политикой конфиденциальности');
                if (privacyCheckbox) privacyCheckbox.focus();
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                isSubmittingContactForm = false;
                return;
            }
            
            // Простая проверка телефона (минимум 10 цифр)
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                const phoneValue = phoneInput.value;
                const phoneDigits = phoneValue.replace(/\D/g, '');
                
                if (phoneDigits.length < 10 && phoneDigits.length > 0) {
                    alert('Пожалуйста, введите корректный номер телефона (минимум 10 цифр)');
                    phoneInput.focus();
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                    isSubmittingContactForm = false;
                    return;
                }
            }
            
            // Собираем данные формы
            const formData = new FormData(this);
            
            // Отправляем запрос
            fetch('/contacts', {
                method: 'POST',
                headers: {
                    'Accept': 'application/json'
                },
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Ошибка сети');
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    alert(data.message);
                    // Сбрасываем форму
                    contactForm.reset();
                    // Убираем класс валидации
                    contactForm.classList.remove('was-validated');
                } else {
                    alert('Ошибка: ' + (data.errors ? data.errors.join(', ') : data.error));
                }
            })
            .catch(error => {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при отправке формы. Пожалуйста, попробуйте еще раз.');
            })
            .finally(() => {
                // Восстанавливаем кнопку
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                isSubmittingContactForm = false;
            });
        });
    }
    
    // Добавляем Bootstrap валидацию
    if (contactForm) {
        // Отключаем стандартную валидацию браузера
        contactForm.setAttribute('novalidate', '');
        
        // Добавляем валидацию для всех полей при потере фокуса
        const requiredFields = contactForm.querySelectorAll('[required]');
        requiredFields.forEach(field => {
            field.addEventListener('blur', function() {
                validateField(this);
            });
            
            // Очищаем ошибку при вводе
            field.addEventListener('input', function() {
                if (this.value.trim()) {
                    this.classList.remove('is-invalid');
                    const errorDiv = this.nextElementSibling;
                    if (errorDiv && errorDiv.classList.contains('invalid-feedback')) {
                        errorDiv.remove();
                    }
                }
            });
        });
        
        // Функция валидации поля
        function validateField(field) {
            if (!field.value.trim()) {
                field.classList.add('is-invalid');
                if (!field.nextElementSibling || !field.nextElementSibling.classList.contains('invalid-feedback')) {
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'invalid-feedback';
                    errorDiv.textContent = 'Это поле обязательно для заполнения';
                    field.parentNode.insertBefore(errorDiv, field.nextSibling);
                }
            } else {
                field.classList.remove('is-invalid');
                const errorDiv = field.nextElementSibling;
                if (errorDiv && errorDiv.classList.contains('invalid-feedback')) {
                    errorDiv.remove();
                }
                
                // Специальная валидация для email
                if (field.type === 'email' && field.value) {
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(field.value)) {
                        field.classList.add('is-invalid');
                        const errorDiv = field.nextElementSibling || document.createElement('div');
                        if (!errorDiv.classList.contains('invalid-feedback')) {
                            errorDiv.className = 'invalid-feedback';
                            errorDiv.textContent = 'Введите корректный email адрес';
                            field.parentNode.insertBefore(errorDiv, field.nextSibling);
                        }
                    }
                }
                
                // Специальная валидация для телефона (необязательная, можно ввести любой формат)
                if (field.id === 'phone' && field.value) {
                    // Просто проверяем что есть хоть какие-то цифры
                    const digits = field.value.replace(/\D/g, '');
                    if (digits.length < 5 && digits.length > 0) {
                        field.classList.add('is-invalid');
                        const errorDiv = field.nextElementSibling || document.createElement('div');
                        if (!errorDiv.classList.contains('invalid-feedback')) {
                            errorDiv.className = 'invalid-feedback';
                            errorDiv.textContent = 'Введите корректный номер телефона';
                            field.parentNode.insertBefore(errorDiv, field.nextSibling);
                        }
                    }
                }
            }
        }
    }
});
</script>